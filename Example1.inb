[{"kind":1,"language":"markdown","value":"# Consuming REST web services from RPG example\nIn this example we will create a customers table and populate some rows with random data, using an RPG program with embedded SQL that will call namy API to get randomized name data.\n\nFor this example to work, first you must set a current library.  You can do that in VSCODE by right clicking on any library in the library list and choosing 'change current library/schema'.  If you haven't added any libraries to your library list, do that first.\n\nNext lets create the table by running the following CL command..."},{"kind":2,"language":"cl","value":"RUNSQLSTM SRCSTMF('./QSQLSRC/CUSTOMER.TABLE') COMMIT(*NONE)"},{"kind":1,"language":"markdown","value":"The CUSTOMER.TABLE file referenced in the command above contains DDL code that looks like this:\n```\nCREATE OR REPLACE TABLE CUSTOMER_DDL_TABLE FOR SYSTEM NAME CUSTOMERS\n(\n    CUSTOMER_ID            FOR COLUMN CSID  CHAR(9)    CCSID 37 NOT NULL DEFAULT '' ,\n    CUSTOMER_NAME_LAST     FOR COLUMN CSNML CHAR(25)   CCSID 37 NOT NULL DEFAULT '' ,\n    CUSTOMER_NAME_FIRST    FOR COLUMN CSNMF CHAR(14)   CCSID 37 NOT NULL DEFAULT '' ,\n    CUSTOMER_NAME_MI       FOR COLUMN CSNMM CHAR(14)   CCSID 37 NOT NULL DEFAULT '' \n) RCDFMT FCSREAA ;\n\nLABEL ON TABLE CUSTOMER_DDL_TABLE\nIS 'Customer           DDL Table' ;\n\nLABEL ON COLUMN CUSTOMER_DDL_TABLE\n(\n   CUSTOMER_ID             IS 'Customer ID' ,\n   CUSTOMER_NAME_LAST      IS 'Customer Name Last' ,\n   CUSTOMER_NAME_FIRST     IS 'Customer Name First' ,\n   CUSTOMER_NAME_MI        IS 'Customer Name Middle Initial'\n) ;\n\nLABEL ON COLUMN CUSTOMER_DDL_TABLE\n(\n   CUSTOMER_ID             TEXT IS 'Customer ID' ,\n   CUSTOMER_NAME_LAST      TEXT IS 'Customer Name Last' ,\n   CUSTOMER_NAME_FIRST     TEXT IS 'Customer Name First' ,\n   CUSTOMER_NAME_MI        TEXT IS 'Customer Name Middle Initial'\n) ;\n\n```\nThere is an ID field, which is intended to be a unique identifier for the record, as well as 3 name fields.\n"},{"kind":2,"language":"sql","value":"set current schema jweirich1;"},{"kind":1,"language":"markdown","value":"Lets go ahead and add a record to the customer table"},{"kind":2,"language":"sql","value":"insert into customer_ddl_table \nvalues ('000000001','SMITH','FRED','M')\n;"},{"kind":2,"language":"sql","value":"select * from JWEIRICH1.customer_ddl_table"},{"kind":1,"language":"markdown","value":"The following SQL uses the HTTPGETCLOB function to get randomized names from US census data."},{"kind":2,"language":"sql","value":"select Systools.HTTPGETCLOB(\n    URL => CAST('https://namey.muffinlabs.com/name.json?count=1&with_surname=true&frequency=common' AS VARCHAR(255)),\n    HTTPHEADER => CAST(NULL AS CLOB(1K))) \n    as Names_Array\nfrom sysibm.sysdummy1"},{"kind":1,"language":"markdown","value":"We can wrap it in a JSON_TABLE function to get results into a column."},{"kind":2,"language":"sql","value":"select *\nfrom JSON_TABLE(\n    Systools.HTTPGETCLOB(\n      URL => CAST('https://namey.muffinlabs.com/name.json?count=1&with_surname=true&frequency=common' AS VARCHAR(255)),\n      HTTPHEADER => CAST(NULL AS CLOB(1K))\n    ),'$'\n    COLUMNS(\n        FullName CHAR(255) path '$'\n    ) error on error\n) as x"},{"kind":1,"language":"markdown","value":"That still doesn't give us a randomized middle initial.  The following code can do that."},{"kind":2,"language":"sql","value":"  Values CHR(INT(RAND()*26)+65)"}]